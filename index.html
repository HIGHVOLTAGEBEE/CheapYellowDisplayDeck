<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>CYD Deck Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #0d0d0d;
            color: #e8e8e8;
            padding: 0;
            overflow-x: hidden
        }

        .top-bar {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-bottom: 2px solid#404040;
            padding: 20px 30px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
            animation: slideDown 0.4s ease
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%)
            }

            to {
                transform: translateY(0)
            }
        }

        .top-bar h1 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 26px;
            font-weight: 600;
            letter-spacing: 0.5px
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger,
        .btn-help,
        .btn-style {
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            color: #fff;
            position: relative;
            overflow: hidden
        }

        .btn-primary {
            background: linear-gradient(135deg, #505050 0%, #3a3a3a 100%);
            box-shadow: 0 2px 8px rgba(80, 80, 80, 0.4)
        }

        .btn-secondary {
            background: linear-gradient(135deg, #606060 0%, #4a4a4a 100%);
            box-shadow: 0 2px 8px rgba(96, 96, 96, 0.4)
        }

        .btn-danger {
            background: linear-gradient(135deg, #8a2020 0%, #6a1010 100%);
            box-shadow: 0 2px 8px rgba(138, 32, 32, 0.4)
        }

        .btn-help {
            background: linear-gradient(135deg, #505050 0%, #3a3a3a 100%);
            box-shadow: 0 2px 8px rgba(80, 80, 80, 0.4)
        }

        .btn-style {
            background: linear-gradient(135deg, #606060 0%, #4a4a4a 100%);
            box-shadow: 0 2px 8px rgba(96, 96, 96, 0.4)
        }

        .btn-primary:hover,
        .btn-secondary:hover,
        .btn-danger:hover,
        .btn-help:hover,
        .btn-style:hover {
            transform: translateY(-2px);
            filter: brightness(1.2)
        }

        .btn-primary:active,
        .btn-secondary:active,
        .btn-danger:active,
        .btn-help:active,
        .btn-style:active {
            transform: translateY(0)
        }

        .menu-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 20px 30px;
            background: #151515;
            border-bottom: 1px solid#303030;
            scrollbar-width: thin;
            scrollbar-color: #505050#1a1a1a
        }

        .menu-tabs::-webkit-scrollbar {
            height: 8px
        }

        .menu-tabs::-webkit-scrollbar-track {
            background: #1a1a1a
        }

        .menu-tabs::-webkit-scrollbar-thumb {
            background: #505050;
            border-radius: 4px
        }

        .menu-tab {
            background: #252525;
            color: #b0b0b0;
            border: 1px solid#3a3a3a;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: move;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s;
            position: relative;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9)
            }

            to {
                opacity: 1;
                transform: scale(1)
            }
        }

        .menu-tab:hover {
            background: #353535;
            color: #fff;
            transform: translateY(-2px)
        }

        .menu-tab.active {
            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #fff;
            border-color: #5a5a5a;
            box-shadow: 0 2px 8px rgba(90, 90, 90, 0.5)
        }

        .menu-tab.dragging {
            opacity: 0.5;
            transform: scale(0.95)
        }

        .menu-tab.drag-over {
            border-color: #6a6a6a;
            border-width: 2px
        }

        .menu-tab-actions {
            display: flex;
            gap: 4px
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1)
        }

        .tab-btn.copy {
            background: rgba(106, 106, 106, 0.3)
        }

        .tab-btn.copy:hover {
            background: rgba(106, 106, 106, 0.5)
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px
        }

        .menu {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            border: 1px solid#303030;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
            display: none;
            animation: menuSlide 0.3s ease
        }

        @keyframes menuSlide {
            from {
                opacity: 0;
                transform: translateY(20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .menu.active {
            display: block
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
            padding-bottom: 20px;
            border-bottom: 2px solid#303030
        }

        .menu-header input {
            flex: 1;
            min-width: 250px;
            background: #111;
            color: #e8e8e8;
            border: 2px solid#3a3a3a;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s
        }

        .menu-header input:focus {
            outline: none;
            border-color: #5a5a5a;
            box-shadow: 0 0 0 3px rgba(90, 90, 90, 0.2)
        }

        .menu-info {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap
        }

        .color-controls {
            background: #111;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid#303030
        }

        .color-controls h3 {
            color: #fff;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 600
        }

        .color-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center
        }

        .color-select-group {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .btn-color {
            background: #252525;
            color: #e8e8e8;
            border: 1px solid#3a3a3a;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s
        }

        .btn-color:hover {
            background: #353535;
            border-color: #5a5a5a;
            transform: translateY(-2px)
        }

        label.select-label {
            color: #b0b0b0;
            font-size: 13px;
            font-weight: 500;
            margin-right: 8px
        }

        select {
            background: #111;
            color: #e8e8e8;
            border: 2px solid#3a3a3a;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s
        }

        select:focus {
            outline: none;
            border-color: #5a5a5a
        }

        select:hover {
            border-color: #4a4a4a
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px
        }

        .btn-config {
            background: #111;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid#303030;
            transition: all 0.3s;
            position: relative;
            animation: cardFade 0.4s ease
        }

        @keyframes cardFade {
            from {
                opacity: 0;
                transform: scale(0.95)
            }

            to {
                opacity: 1;
                transform: scale(1)
            }
        }

        .btn-config:hover {
            border-color: #4a4a4a;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
            transform: translateY(-4px)
        }

        .btn-config.has-image {
            border-color: #5a5a5a
        }

        .image-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #505050;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            animation: pulse 2s ease infinite
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0.7
            }
        }

        .btn-config h3 {
            color: #fff;
            font-size: 15px;
            margin-bottom: 18px;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 1px solid#303030
        }

        .btn-config label {
            display: block;
            margin: 14px 0 8px;
            color: #b0b0b0;
            font-size: 13px;
            font-weight: 500
        }

        .btn-config input[type=text],
        .btn-config input[type=number] {
            width: 100%;
            background: #0a0a0a;
            color: #e8e8e8;
            border: 1px solid#3a3a3a;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s
        }

        .btn-config input[type=text]:focus,
        .btn-config input[type=number]:focus {
            outline: none;
            border-color: #5a5a5a;
            box-shadow: 0 0 0 3px rgba(90, 90, 90, 0.2);
            transform: translateY(-2px)
        }

        .btn-config select {
            width: 100%;
            background: #0a0a0a;
            color: #e8e8e8;
            border: 1px solid#3a3a3a;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s
        }

        .btn-config select:focus {
            outline: none;
            border-color: #5a5a5a
        }

        .btn-config select:hover {
            border-color: #4a4a4a
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 14px 0;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s
        }

        .checkbox-label:hover {
            transform: translateX(4px)
        }

        .checkbox-label input[type=checkbox] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #6a6a6a
        }

        .checkbox-label span {
            color: #e8e8e8;
            font-size: 14px;
            font-weight: 500
        }

        .color-row {
            display: flex;
            gap: 12px;
            align-items: center
        }

        .color-preview {
            width: 50px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid#3a3a3a;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5)
        }

        .color-preview:hover {
            transform: scale(1.1);
            border-color: #5a5a5a;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1)
        }

        .color-preview:active {
            transform: scale(0.95)
        }

        .image-upload-area {
            margin-top: 12px;
            padding: 15px;
            background: #0a0a0a;
            border: 2px dashed#3a3a3a;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s
        }

        .image-upload-area:hover {
            border-color: #5a5a5a;
            background: #111;
            transform: scale(1.02)
        }

        .image-upload-area.has-image {
            border-style: solid;
            border-color: #505050
        }

        .upload-label {
            display: block;
            color: #b0b0b0;
            font-size: 13px;
            margin-bottom: 10px
        }

        .image-preview-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap
        }

        .image-preview {
            width: 67px;
            height: 67px;
            border: 2px solid#4a4a4a;
            border-radius: 6px;
            object-fit: cover;
            background: #0d0d0d;
            transition: all 0.3s
        }

        .image-preview:hover {
            transform: scale(1.1);
            border-color: #6a6a6a
        }

        .upload-info {
            color: #909090;
            font-size: 12px;
            margin-top: 8px
        }

        .remove-image {
            background: #8a2020;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.2s
        }

        .remove-image:hover {
            background: #aa3030;
            transform: scale(1.05)
        }

        input[type=file] {
            display: none
        }

        .status {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 10px;
            display: none;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            animation: slideIn 0.3s ease
        }

        .status.success {
            background: linear-gradient(135deg, #505050 0%, #3a3a3a 100%);
            color: #fff
        }

        .status.error {
            background: linear-gradient(135deg, #8a2020 0%, #6a1010 100%);
            color: #fff
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0
            }

            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px)
        }

        .modal.active {
            display: flex;
            animation: modalFade 0.3s ease
        }

        @keyframes modalFade {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 16px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid#404040;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            position: relative;
            animation: modalSlide 0.3s ease
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid#303030
        }

        .modal-header h2 {
            color: #fff;
            font-size: 24px;
            font-weight: 600
        }

        .modal-close {
            background: #8a2020;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s
        }

        .modal-close:hover {
            background: #aa3030;
            transform: scale(1.05)
        }

        .modal-body {
            color: #e8e8e8;
            line-height: 1.8;
            font-size: 15px
        }

        .modal-body h3 {
            color: #fff;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 18px
        }

        .modal-body p {
            margin-bottom: 15px
        }

        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 15px
        }

        .modal-body li {
            margin-bottom: 8px
        }

        .modal-body code {
            background: #111;
            padding: 2px 6px;
            border-radius: 4px;
            color: #b0b0b0
        }

        .style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px
        }

        .style-section {
            background: #111;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid#303030;
            transition: all 0.3s
        }

        .style-section:hover {
            border-color: #4a4a4a;
            transform: translateY(-2px)
        }

        .style-section h3 {
            color: #fff;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 1px solid#303030
        }

        .style-field {
            margin-bottom: 15px
        }

        .style-field label {
            display: block;
            color: #b0b0b0;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px
        }

        .style-field input {
            width: 100%;
            background: #0a0a0a;
            color: #e8e8e8;
            border: 1px solid#3a3a3a;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s
        }

        .style-field input:focus {
            outline: none;
            border-color: #5a5a5a
        }

        .color-array {
            display: flex;
            gap: 10px
        }

        .color-array input {
            flex: 1
        }

        canvas {
            display: none
        }

        .action-input-container {
            transition: all 0.3s ease;
            overflow: hidden
        }

        .action-input-container.hidden {
            max-height: 0;
            opacity: 0;
            margin: 0;
            padding: 0
        }

        .action-input-container.visible {
            max-height: 200px;
            opacity: 1
        }
    </style>
</head>

<body>
    <div class='top-bar'>
        <h1>CheapYellowDisplayDeck Editor by HIGHVOLTAGEBEE</h1>
        <div class='controls'><button class='btn-primary' onclick='downloadPackage()'>Download Package
                (ZIP)</button><button class='btn-secondary' onclick='loadConfig()'>Load config.json</button><button
                class='btn-style' onclick='openStyleConfig()'>⚙️ Style Config</button><button class='btn-secondary'
                onclick='addMenu()'>Add Menu</button><button class='btn-help' onclick='openHelp()'>Help</button><button
                class='btn-secondary' onclick='location.reload()'>Reset Editor</button></div>
    </div>
    <input type='file' id='fileInput' accept='.json' onchange='handleFileLoad(event)'>
    <input type='file' id='imageInput' accept='image/*' onchange='handleImageUpload(event)'>
    <div class='menu-tabs' id='tabs'></div>
    <div class='container' id='menus'></div>
    <div class='status' id='status'></div>
    <div class='modal' id='helpModal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>📖 Documentation</h2><button class='modal-close' onclick='closeHelp()'>✕ Close</button>
            </div>
            <div class='modal-body'>
                <h3>Welcome to CYD Deck Editor</h3>
                <h3>Action Types</h3>
                <ul>
                    <li><strong>Keystroke:</strong> Send keyboard combinations → <code>CTRL+C</code>, <code>WIN+D</code>
                    </li>
                    <li><strong>Text Input:</strong> Type text automatically → <code>"Hello World"</code></li>
                    <li><strong>URL:</strong> Open web links → <code>|https://google.com|</code></li>
                    <li><strong>File Path:</strong> Open files or folders → <code>|C:\Users\Documents|</code></li>
                    <li><strong>CMD Command:</strong> Execute command line → <code>&lt;dir&gt;</code></li>
                    <li><strong>Execute Program:</strong> Run applications → <code>EXECUTE+C:\Program.exe</code></li>
                    <li><strong>Menu Link:</strong> Navigate to another menu</li>
                </ul>
                <h3>Format Examples</h3>
                <ul>
                    <li><strong>Keystroke:</strong> <code>CTRL+C</code>, <code>ALT+F4</code>, <code>WIN+TAB</code></li>
                    <li><strong>Text with Modifiers:</strong> <code>CTRL+"text"</code></li>
                    <li><strong>Text Input (Strings):</strong> <code>"Your message here"</code> - Use double quotes ""
                    </li>
                    <li><strong>URL:</strong> <code>|https://example.com|</code> - Use pipe characters ||</li>
                    <li><strong>File Path:</strong> <code>|C:\folder\file.txt|</code> - Use pipe characters ||</li>
                    <li><strong>CMD Command:</strong> <code>&lt;ipconfig&gt;</code>,
                        <code>&lt;shutdown /s /t 0&gt;</code> - Use angle brackets &lt;&gt;
                    </li>
                    <li><strong>Execute:</strong> <code>EXECUTE+notepad.exe</code></li>
                </ul>
                <h3>Character Format Summary</h3>
                <ul>
                    <li><strong>"" (Double Quotes)</strong> → Text/String Input</li>
                    <li><strong>|| (Pipes)</strong> → URLs and File Paths</li>
                    <li><strong>&lt;&gt; (Angle Brackets)</strong> → CMD Commands</li>
                </ul>
                <h3>Special Keys</h3>
                <ul>
                    <li><strong>Modifiers:</strong> CTRL, ALT, SHIFT, WIN, FN</li>
                    <li><strong>Function:</strong> F1-F24, ESC, TAB, ENTER, SPACE, BACKSPACE, DELETE</li>
                    <li><strong>Navigation:</strong> UP, DOWN, LEFT, RIGHT, HOME, END, PAGEUP, PAGEDOWN</li>
                </ul>
                <h3>Features</h3>
                <ul>
                    <li><strong>Create Menus:</strong> Add unlimited menus with 12 buttons each</li>
                    <li><strong>Move Menus:</strong> Drag and drop tabs to reorder</li>
                    <li><strong>Copy Menus:</strong> Duplicate entire menus with one click</li>
                    <li><strong>Upload Icons:</strong> Add 67x67px images for buttons</li>
                    <li><strong>Bulk Colors:</strong> Set colors for rows, columns, or all buttons</li>
                    <li><strong>Style Config:</strong> Configure LED colors and system settings</li>
                </ul>
            </div>
        </div>
    </div>
    <div class='modal' id='styleModal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>⚙️ Style Configuration</h2><button class='modal-close' onclick='closeStyleConfig()'>✕ Close</button>
            </div>
            <div class='modal-body'>
                <div class='style-grid'>
                    <div class='style-section'>
                        <h3>General Settings</h3>
                        <div class='style-field'><label>LED Enabled</label>
                            <div class='checkbox-label'><input type='checkbox' id='ledEnabled' checked
                                    onchange='updateStyleConfig()'><span>Enable LED</span></div>
                        </div>
                        <div class='style-field'><label>Sleep Timeout (ms)</label><input type='number' id='sleepTimeout'
                                value='5000' onchange='updateStyleConfig()'></div>
                        <div class='style-field'><label>Screen Update Interval (ms)</label><input type='number'
                                id='screenUpdateInterval' value='5' onchange='updateStyleConfig()'></div>
                        <div class='style-field'><label>OK Interval (ms)</label><input type='number' id='okInterval'
                                value='600' onchange='updateStyleConfig()'></div>
                        <div class='style-field'><label>LED Brightness (0-255)</label><input type='number'
                                id='ledBrightness' min='0' max='255' value='10' onchange='updateStyleConfig()'></div>
                    </div>
                    <div class='style-section'>
                        <h3>LED Colors (RGB)</h3>
                        <div class='style-field'><label>Connected Color</label>
                            <div class='color-array'><input type='number' id='ledColorConnected0' min='0' max='255'
                                    value='0' placeholder='R' onchange='updateStyleConfig()'><input type='number'
                                    id='ledColorConnected1' min='0' max='255' value='255' placeholder='G'
                                    onchange='updateStyleConfig()'><input type='number' id='ledColorConnected2' min='0'
                                    max='255' value='0' placeholder='B' onchange='updateStyleConfig()'></div>
                        </div>
                        <div class='style-field'><label>Disconnected Color</label>
                            <div class='color-array'><input type='number' id='ledColorDisconnected0' min='0' max='255'
                                    value='255' placeholder='R' onchange='updateStyleConfig()'><input type='number'
                                    id='ledColorDisconnected1' min='0' max='255' value='0' placeholder='G'
                                    onchange='updateStyleConfig()'><input type='number' id='ledColorDisconnected2'
                                    min='0' max='255' value='0' placeholder='B' onchange='updateStyleConfig()'></div>
                        </div>
                        <div class='style-field'><label>Active Color</label>
                            <div class='color-array'><input type='number' id='ledColorActive0' min='0' max='255'
                                    value='0' placeholder='R' onchange='updateStyleConfig()'><input type='number'
                                    id='ledColorActive1' min='0' max='255' value='255' placeholder='G'
                                    onchange='updateStyleConfig()'><input type='number' id='ledColorActive2' min='0'
                                    max='255' value='0' placeholder='B' onchange='updateStyleConfig()'></div>
                        </div>
                        <div class='style-field'><label>Button Color</label>
                            <div class='color-array'><input type='number' id='ledColorButton0' min='0' max='255'
                                    value='255' placeholder='R' onchange='updateStyleConfig()'><input type='number'
                                    id='ledColorButton1' min='0' max='255' value='165' placeholder='G'
                                    onchange='updateStyleConfig()'><input type='number' id='ledColorButton2' min='0'
                                    max='255' value='0' placeholder='B' onchange='updateStyleConfig()'></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <canvas id='canvas'></canvas>
    <script>
        let cfg = { menuCount: 1, menus: [{ name: 'Main Menu', parent: -1, buttons: [] }], styleConfig: { ledEnabled: true, sleepTimeout: 5000, screenUpdateInterval: 5, okInterval: 600, ledColorConnected: [0, 255, 0], ledColorDisconnected: [255, 0, 0], ledColorActive: [0, 255, 0], ledColorButton: [255, 165, 0], ledBrightness: 10 } }; for (let i = 0; i < 12; i++)cfg.menus[0].buttons.push({ active: false, color: 0x2196, text: '', icon: '', action: '', target: -1, imageData: null }); let activeMenu = 0, currentUploadButton = null, draggedMenu = null; function showStatus(m, t) { let s = document.getElementById('status'); s.textContent = m; s.className = 'status ' + (t || 'success'); s.style.display = 'block'; setTimeout(() => s.style.display = 'none', 3000) } function switchMenu(i) { activeMenu = i; render() } function openHelp() { document.getElementById('helpModal').classList.add('active') } function closeHelp() { document.getElementById('helpModal').classList.remove('active') } function openStyleConfig() { loadStyleConfig(); document.getElementById('styleModal').classList.add('active') } function closeStyleConfig() { document.getElementById('styleModal').classList.remove('active') } function loadStyleConfig() { let s = cfg.styleConfig; document.getElementById('ledEnabled').checked = s.ledEnabled; document.getElementById('sleepTimeout').value = s.sleepTimeout; document.getElementById('screenUpdateInterval').value = s.screenUpdateInterval; document.getElementById('okInterval').value = s.okInterval; document.getElementById('ledBrightness').value = s.ledBrightness; document.getElementById('ledColorConnected0').value = s.ledColorConnected[0]; document.getElementById('ledColorConnected1').value = s.ledColorConnected[1]; document.getElementById('ledColorConnected2').value = s.ledColorConnected[2]; document.getElementById('ledColorDisconnected0').value = s.ledColorDisconnected[0]; document.getElementById('ledColorDisconnected1').value = s.ledColorDisconnected[1]; document.getElementById('ledColorDisconnected2').value = s.ledColorDisconnected[2]; document.getElementById('ledColorActive0').value = s.ledColorActive[0]; document.getElementById('ledColorActive1').value = s.ledColorActive[1]; document.getElementById('ledColorActive2').value = s.ledColorActive[2]; document.getElementById('ledColorButton0').value = s.ledColorButton[0]; document.getElementById('ledColorButton1').value = s.ledColorButton[1]; document.getElementById('ledColorButton2').value = s.ledColorButton[2] } function updateStyleConfig() { cfg.styleConfig = { ledEnabled: document.getElementById('ledEnabled').checked, sleepTimeout: parseInt(document.getElementById('sleepTimeout').value), screenUpdateInterval: parseInt(document.getElementById('screenUpdateInterval').value), okInterval: parseInt(document.getElementById('okInterval').value), ledColorConnected: [parseInt(document.getElementById('ledColorConnected0').value), parseInt(document.getElementById('ledColorConnected1').value), parseInt(document.getElementById('ledColorConnected2').value)], ledColorDisconnected: [parseInt(document.getElementById('ledColorDisconnected0').value), parseInt(document.getElementById('ledColorDisconnected1').value), parseInt(document.getElementById('ledColorDisconnected2').value)], ledColorActive: [parseInt(document.getElementById('ledColorActive0').value), parseInt(document.getElementById('ledColorActive1').value), parseInt(document.getElementById('ledColorActive2').value)], ledColorButton: [parseInt(document.getElementById('ledColorButton0').value), parseInt(document.getElementById('ledColorButton1').value), parseInt(document.getElementById('ledColorButton2').value)], ledBrightness: parseInt(document.getElementById('ledBrightness').value) } } function applyBulkColor() { let t = document.getElementById('colorType_' + activeMenu).value, v = document.getElementById('bulkColorPicker_' + activeMenu).value, c = hexToRgb565(v), m = cfg.menus[activeMenu]; if (t === 'all') { for (let i = 0; i < 12; i++)if (!m.buttons[i].imageData) m.buttons[i].color = c; showStatus('✓ Color applied to all buttons!') } else if (t.startsWith('row')) { let r = parseInt(t.replace('row', '')) - 1; for (let i = 0; i < 3; i++) { let idx = r * 3 + i; if (!m.buttons[idx].imageData) m.buttons[idx].color = c } showStatus('✓ Color applied to row!') } else if (t.startsWith('col')) { let col = parseInt(t.replace('col', '')) - 1; for (let i = 0; i < 4; i++) { let idx = i * 3 + col; if (!m.buttons[idx].imageData) m.buttons[idx].color = c } showStatus('✓ Color applied to column!') } else { let btnIdx = parseInt(t.replace('btn', '')) - 1; if (!m.buttons[btnIdx].imageData) { m.buttons[btnIdx].color = c; showStatus('✓ Color applied to button!') } else showStatus('✗ Button already has an image!', 'error') } render() } function copyMenu(m) { let source = cfg.menus[m], newMenu = { name: source.name + ' (Copy)', parent: source.parent, buttons: [] }; for (let i = 0; i < 12; i++) { let btn = source.buttons[i]; newMenu.buttons.push({ active: btn.active, color: btn.color, text: btn.text, icon: btn.icon, action: btn.action, target: btn.target, imageData: btn.imageData }) } cfg.menus.splice(m + 1, 0, newMenu); cfg.menuCount++; updateIndices(); activeMenu = m + 1; render(); showStatus('✓ Menu copied!') } function moveMenu(fromIdx, toIdx) { if (fromIdx === toIdx || toIdx < 0 || toIdx >= cfg.menuCount) return; let indexMap = new Array(cfg.menuCount); if (fromIdx < toIdx) { for (let i = 0; i < cfg.menuCount; i++)indexMap[i] = i === fromIdx ? toIdx : i > fromIdx && i <= toIdx ? i - 1 : i } else { for (let i = 0; i < cfg.menuCount; i++)indexMap[i] = i === fromIdx ? toIdx : i >= toIdx && i < fromIdx ? i + 1 : i } let menu = cfg.menus.splice(fromIdx, 1)[0]; cfg.menus.splice(toIdx, 0, menu); for (let i = 0; i < cfg.menuCount; i++) { let m = cfg.menus[i]; if (m.parent >= 0) m.parent = indexMap[m.parent]; for (let j = 0; j < 12; j++) { let btn = m.buttons[j]; if (btn.target >= 0) btn.target = indexMap[btn.target] } } activeMenu = toIdx; render(); showStatus('✓ Menu moved!') } function updateIndices() { for (let i = 0; i < cfg.menuCount; i++) { let menu = cfg.menus[i]; if (menu.parent >= cfg.menuCount) menu.parent = -1; for (let j = 0; j < 12; j++) { let btn = menu.buttons[j]; if (btn.target >= cfg.menuCount) btn.target = -1 } } } function handleDragStart(e, idx) { draggedMenu = idx; e.target.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/html', e.target.innerHTML) } function handleDragEnd(e) { e.target.classList.remove('dragging'); document.querySelectorAll('.menu-tab').forEach(t => t.classList.remove('drag-over')); draggedMenu = null } function handleDragOver(e) { if (e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect = 'move'; return false } function handleDragEnter(e) { e.target.closest('.menu-tab').classList.add('drag-over') } function handleDragLeave(e) { e.target.closest('.menu-tab').classList.remove('drag-over') } function handleDrop(e, idx) { if (e.stopPropagation) e.stopPropagation(); if (draggedMenu !== null && draggedMenu !== idx) moveMenu(draggedMenu, idx); return false } function formatAction(type, value) { if (type === 'keystroke') return value; if (type === 'text') return '"' + value + '"'; if (type === 'url') return '|' + value + '|'; if (type === 'filepath') return '|' + value + '|'; if (type === 'cmd') return '<' + value + '>'; if (type === 'execute') return 'EXECUTE+' + value; return value } function parseAction(action) { if (!action) return { type: 'keystroke', value: '' }; if (action.startsWith('"') && action.endsWith('"')) return { type: 'text', value: action.slice(1, -1) }; if (action.startsWith('|') && action.endsWith('|')) { let content = action.slice(1, -1); if (content.includes('http://') || content.includes('https://') || content.startsWith('www.')) return { type: 'url', value: content }; return { type: 'filepath', value: content } } if (action.startsWith('<') && action.endsWith('>')) return { type: 'cmd', value: action.slice(1, -1) }; if (action.toUpperCase().startsWith('EXECUTE+')) return { type: 'execute', value: action.slice(8) }; return { type: 'keystroke', value: action } } function escapeHtml(text) { if (!text) return ''; let div = document.createElement('div'); div.textContent = text; return div.innerHTML } function render() { let tabs = ''; for (let m = 0; m < cfg.menuCount; m++) { let safeName = escapeHtml(cfg.menus[m].name); tabs += "<div class='menu-tab " + (m === activeMenu ? "active" : "") + "' draggable='true' ondragstart='handleDragStart(event," + m + ")' ondragend='handleDragEnd(event)' ondragover='handleDragOver(event)' ondragenter='handleDragEnter(event)' ondragleave='handleDragLeave(event)' ondrop='handleDrop(event," + m + ")'><span onclick='switchMenu(" + m + ")' style='cursor:pointer'>" + safeName + "</span><div class='menu-tab-actions'><button class='tab-btn copy' onclick='event.stopPropagation();copyMenu(" + m + ")'>📋</button></div></div>" } document.getElementById('tabs').innerHTML = tabs; let h = ''; for (let m = 0; m < cfg.menuCount; m++) { let menu = cfg.menus[m], safeName = escapeHtml(menu.name); h += "<div class='menu " + (m === activeMenu ? "active" : "") + "'><div class='menu-header'><input type='text' value='" + safeName + "' onchange='cfg.menus[" + m + "].name=this.value;render()'><div class='menu-info'><label class='select-label'>Parent Menu:</label><select onchange='cfg.menus[" + m + "].parent=parseInt(this.value)'><option value='-1'>Main Menu</option>"; for (let i = 0; i < cfg.menuCount; i++)if (i !== m) { let safeMenuName = escapeHtml(cfg.menus[i].name); h += "<option value='" + i + "' " + (menu.parent === i ? "selected" : "") + ">" + safeMenuName + "</option>" } h += "</select><button class='btn-danger' onclick='delMenu(" + m + ")'>🗑️ Delete Menu</button></div></div><div class='color-controls'><h3>🎨 Bulk Color Function</h3><div class='color-options'><div class='color-select-group'><label class='select-label'>Area:</label><select id='colorType_" + m + "'><option value='all'>All Buttons</option>"; for (let r = 1; r <= 4; r++)h += "<option value='row" + r + "'>Row " + r + "</option>"; for (let c = 1; c <= 3; c++)h += "<option value='col" + c + "'>Column " + c + "</option>"; for (let b = 1; b <= 12; b++)h += "<option value='btn" + b + "'>Button " + b + "</option>"; h += "</select></div><label class='select-label'>Color:</label><div class='color-row'><div class='color-preview' id='bulkColorPreview_" + m + "' style='background:#2196f3' onclick='document.getElementById(\"bulkColorPicker_" + m + "\").click()'></div><input type='color' id='bulkColorPicker_" + m + "' style='display:none' value='#2196f3' onchange='document.getElementById(\"bulkColorPreview_" + m + "\").style.background=this.value'><button class='btn-color' onclick='applyBulkColor()'>Apply Color</button></div></div></div><div class='btn-grid'>"; for (let i = 0; i < 12; i++) { let b = menu.buttons[i], hasImage = b.imageData ? " has-image" : "", parsed = parseAction(b.action); h += "<div class='btn-config" + hasImage + "'>"; if (b.imageData) h += "<span class='image-indicator'>📷 Image</span>"; h += "<h3>Button " + (i + 1) + "</h3><div class='checkbox-label'><input type='checkbox' " + (b.active ? "checked" : "") + " onchange='cfg.menus[" + m + "].buttons[" + i + "].active=this.checked'><span>Active</span></div>"; if (!b.imageData) { let safeText = escapeHtml(b.text); h += "<label>Button Text</label><input type='text' value='" + safeText + "' onchange='cfg.menus[" + m + "].buttons[" + i + "].text=this.value'>" } h += "<label>Action Type</label><select id='actionType_" + m + "_" + i + "' onchange='updateActionType(" + m + "," + i + ")'><option value='keystroke' " + (b.target < 0 && parsed.type === 'keystroke' ? "selected" : "") + ">Keystroke</option><option value='text' " + (b.target < 0 && parsed.type === 'text' ? "selected" : "") + ">Text Input</option><option value='url' " + (b.target < 0 && parsed.type === 'url' ? "selected" : "") + ">URL</option><option value='filepath' " + (b.target < 0 && parsed.type === 'filepath' ? "selected" : "") + ">File Path</option><option value='cmd' " + (b.target < 0 && parsed.type === 'cmd' ? "selected" : "") + ">CMD Command</option><option value='execute' " + (b.target < 0 && parsed.type === 'execute' ? "selected" : "") + ">Execute Program</option><option value='menu' " + (b.target >= 0 ? "selected" : "") + ">Menu Link</option></select><div id='actionInputContainer_" + m + "_" + i + "' class='action-input-container " + (b.target >= 0 ? "hidden" : "visible") + "'>"; let actionLabel = 'Keystroke', placeholder = 'CTRL+C'; if (parsed.type === 'text') { actionLabel = 'Input'; placeholder = 'Hello World' } else if (parsed.type === 'url') { actionLabel = 'URL'; placeholder = 'https://google.com' } else if (parsed.type === 'filepath') { actionLabel = 'Path'; placeholder = 'C:\\Users\\Documents' } else if (parsed.type === 'cmd') { actionLabel = 'Command'; placeholder = 'ipconfig' } else if (parsed.type === 'execute') { actionLabel = 'Program Path'; placeholder = 'C:\\Program Files\\app.exe' } let safeValue = escapeHtml(parsed.value); h += "<label id='actionLabel_" + m + "_" + i + "'>" + actionLabel + "</label><input type='text' id='actionInput_" + m + "_" + i + "' value='" + safeValue + "' onchange='updateActionValue(" + m + "," + i + ")' placeholder='" + placeholder + "'></div><div id='menuTargetContainer_" + m + "_" + i + "' class='action-input-container " + (b.target < 0 ? "hidden" : "visible") + "'><label>Target Menu</label><select id='menuTarget_" + m + "_" + i + "' onchange='updateMenuTarget(" + m + "," + i + ")'><option value='-1'>None</option>"; for (let mn = 0; mn < cfg.menuCount; mn++) { let safeMenuName = escapeHtml(cfg.menus[mn].name); h += "<option value='" + mn + "' " + (b.target === mn ? "selected" : "") + ">" + safeMenuName + "</option>" } h += "</select></div>"; if (!b.imageData) h += "<label>Button Color</label><div class='color-row'><div class='color-preview' style='background:#" + rgb565ToHex(b.color) + "' onclick='document.getElementById(\"col_" + m + "_" + i + "\").click()'></div><input type='color' id='col_" + m + "_" + i + "' style='display:none' value='#" + rgb565ToHex(b.color) + "' onchange='cfg.menus[" + m + "].buttons[" + i + "].color=hexToRgb565(this.value);render()'></div>"; h += "<label>Button Icon (67x67px)</label><div class='image-upload-area " + (b.imageData ? "has-image" : "") + "' onclick='openImageUpload(" + m + "," + i + ")'>"; if (b.imageData) h += "<div class='image-preview-container'><img src='" + b.imageData + "' class='image-preview'><div><span class='upload-info'>✓ Image ready</span><br><button class='remove-image' onclick='event.stopPropagation();removeImage(" + m + "," + i + ")'>Remove</button></div></div>"; else h += "<span class='upload-label'>📷 Click to upload image</span><span class='upload-info'>Accepts: JPG, PNG, GIF, WebP</span>"; h += "</div></div>" } h += "</div></div>" } document.getElementById('menus').innerHTML = h } function updateActionType(m, i) { let type = document.getElementById('actionType_' + m + '_' + i).value, b = cfg.menus[m].buttons[i], actionContainer = document.getElementById('actionInputContainer_' + m + '_' + i), menuContainer = document.getElementById('menuTargetContainer_' + m + '_' + i); if (type === 'menu') { b.target = b.target >= 0 ? b.target : 0; b.action = ''; actionContainer.classList.remove('visible'); actionContainer.classList.add('hidden'); menuContainer.classList.remove('hidden'); menuContainer.classList.add('visible') } else { b.target = -1; if (!b.action || b.action === '') { b.action = formatAction(type, '') } else { let parsed = parseAction(b.action); b.action = formatAction(type, parsed.value) } menuContainer.classList.remove('visible'); menuContainer.classList.add('hidden'); actionContainer.classList.remove('hidden'); actionContainer.classList.add('visible'); let actionLabel = 'Keystroke', placeholder = 'CTRL+C'; if (type === 'text') { actionLabel = 'Input'; placeholder = 'Hello World' } else if (type === 'url') { actionLabel = 'URL'; placeholder = 'https://google.com' } else if (type === 'filepath') { actionLabel = 'Path'; placeholder = 'C:\\Users\\Documents' } else if (type === 'cmd') { actionLabel = 'Command'; placeholder = 'ipconfig' } else if (type === 'execute') { actionLabel = 'Program Path'; placeholder = 'C:\\Program Files\\app.exe' } document.getElementById('actionLabel_' + m + '_' + i).textContent = actionLabel; document.getElementById('actionInput_' + m + '_' + i).placeholder = placeholder; let parsed = parseAction(b.action); document.getElementById('actionInput_' + m + '_' + i).value = parsed.value } } function updateActionValue(m, i) { let type = document.getElementById('actionType_' + m + '_' + i).value, value = document.getElementById('actionInput_' + m + '_' + i).value; cfg.menus[m].buttons[i].action = formatAction(type, value) } function updateMenuTarget(m, i) { cfg.menus[m].buttons[i].target = parseInt(document.getElementById('menuTarget_' + m + '_' + i).value) } function hexToRgb565(hex) { let r = parseInt(hex.slice(1, 3), 16) >> 3, g = parseInt(hex.slice(3, 5), 16) >> 2, b = parseInt(hex.slice(5, 7), 16) >> 3; return (r << 11) | (g << 5) | b } function rgb565ToHex(rgb565) { let r = ((rgb565 >> 11) & 0x1F) << 3, g = ((rgb565 >> 5) & 0x3F) << 2, b = (rgb565 & 0x1F) << 3; r = r | (r >> 5); g = g | (g >> 6); b = b | (b >> 5); return r.toString(16).padStart(2, '0') + g.toString(16).padStart(2, '0') + b.toString(16).padStart(2, '0') } function openImageUpload(m, i) { currentUploadButton = { menu: m, button: i }; document.getElementById('imageInput').click() } function handleImageUpload(event) { let file = event.target.files[0]; if (!file || !currentUploadButton) return; let reader = new FileReader(); reader.onload = function (e) { let img = new Image(); img.onload = function () { let canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d'); canvas.width = 67; canvas.height = 67; ctx.drawImage(img, 0, 0, 67, 67); let dataUrl = canvas.toDataURL('image/png'); cfg.menus[currentUploadButton.menu].buttons[currentUploadButton.button].imageData = dataUrl; cfg.menus[currentUploadButton.menu].buttons[currentUploadButton.button].icon = '/i_' + currentUploadButton.menu + '_' + currentUploadButton.button + '.raw'; cfg.menus[currentUploadButton.menu].buttons[currentUploadButton.button].color = 0x0000; cfg.menus[currentUploadButton.menu].buttons[currentUploadButton.button].text = ''; render(); showStatus('✓ Image uploaded!') }; img.src = e.target.result }; reader.readAsDataURL(file); event.target.value = '' } function removeImage(m, i) { cfg.menus[m].buttons[i].imageData = null; cfg.menus[m].buttons[i].icon = ''; cfg.menus[m].buttons[i].text = ''; render(); showStatus('✓ Image removed!') } function imageDataToRgb565(dataUrl) { return new Promise((resolve) => { let img = new Image(); img.onload = function () { let canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d'); canvas.width = 67; canvas.height = 67; ctx.drawImage(img, 0, 0, 67, 67); let imageData = ctx.getImageData(0, 0, 67, 67), pixels = imageData.data, rgb565Data = new Uint8Array(67 * 67 * 2); for (let i = 0; i < 67 * 67; i++) { let r = pixels[i * 4] >> 3, g = pixels[i * 4 + 1] >> 2, b = pixels[i * 4 + 2] >> 3, rgb565 = (r << 11) | (g << 5) | b; rgb565Data[i * 2] = (rgb565 >> 8) & 0xFF; rgb565Data[i * 2 + 1] = rgb565 & 0xFF } resolve(rgb565Data) }; img.src = dataUrl }) } async function downloadPackage() { showStatus('⏳ Creating package...'); let zip = new JSZip(), cleanCfg = JSON.parse(JSON.stringify(cfg)); for (let m = 0; m < cleanCfg.menuCount; m++)for (let i = 0; i < 12; i++)delete cleanCfg.menus[m].buttons[i].imageData; zip.file('config.json', JSON.stringify(cleanCfg, null, 2)); for (let m = 0; m < cfg.menuCount; m++)for (let i = 0; i < 12; i++) { let btn = cfg.menus[m].buttons[i]; if (btn.imageData) { let rgb565Data = await imageDataToRgb565(btn.imageData); zip.file('i_' + m + '_' + i + '.raw', rgb565Data) } } zip.generateAsync({ type: 'blob' }).then(function (blob) { let url = URL.createObjectURL(blob), a = document.createElement('a'); a.href = url; a.download = 'cyd_deck_config.zip'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); showStatus('✓ Package downloaded!') }) } function addMenu() { let newMenu = { name: 'Menu ' + (cfg.menuCount + 1), parent: -1, buttons: [] }; for (let i = 0; i < 12; i++)newMenu.buttons.push({ active: false, color: 0x2196, text: '', icon: '', action: '', target: -1, imageData: null }); cfg.menus.push(newMenu); cfg.menuCount++; activeMenu = cfg.menuCount - 1; render(); showStatus('✓ Menu added!') } function delMenu(m) { if (!confirm('Delete this menu?')) return; cfg.menus.splice(m, 1); cfg.menuCount--; for (let i = 0; i < cfg.menuCount; i++) { if (cfg.menus[i].parent > m) cfg.menus[i].parent--; else if (cfg.menus[i].parent === m) cfg.menus[i].parent = -1; for (let j = 0; j < 12; j++) { if (cfg.menus[i].buttons[j].target > m) cfg.menus[i].buttons[j].target--; else if (cfg.menus[i].buttons[j].target === m) cfg.menus[i].buttons[j].target = -1 } } if (activeMenu >= cfg.menuCount) activeMenu = cfg.menuCount - 1; if (activeMenu < 0) activeMenu = 0; render(); showStatus('✓ Menu deleted!') } function loadConfig() { document.getElementById('fileInput').click() } async function handleFileLoad(event) { let file = event.target.files[0]; if (!file) return; if (file.name.endsWith('.zip')) { handleZipLoad(event); return } let reader = new FileReader(); reader.onload = function (e) { try { let loaded = JSON.parse(e.target.result); if (loaded.menus && loaded.menuCount) { for (let m = 0; m < loaded.menuCount; m++)for (let i = 0; i < 12; i++)if (!loaded.menus[m].buttons[i].imageData) loaded.menus[m].buttons[i].imageData = null; if (!loaded.styleConfig) loaded.styleConfig = { ledEnabled: true, sleepTimeout: 5000, screenUpdateInterval: 5, okInterval: 600, ledColorConnected: [0, 255, 0], ledColorDisconnected: [255, 0, 0], ledColorActive: [0, 255, 0], ledColorButton: [255, 165, 0], ledBrightness: 10 }; cfg = loaded; activeMenu = 0; render(); showStatus('✓ Config loaded!') } else showStatus('✗ Invalid config file!', 'error') } catch (err) { showStatus('✗ Failed to parse JSON!', 'error') } }; reader.readAsText(file); event.target.value = '' } async function handleZipLoad(event) { let file = event.target.files[0]; if (!file) return; showStatus('⏳ Loading ZIP...'); try { let zip = await JSZip.loadAsync(file), configFile = zip.file('config.json'); if (!configFile) { showStatus('✗ No config.json in ZIP!', 'error'); return } let configText = await configFile.async('text'), loaded = JSON.parse(configText); if (!loaded.menus || !loaded.menuCount) { showStatus('✗ Invalid config!', 'error'); return } if (!loaded.styleConfig) loaded.styleConfig = { ledEnabled: true, sleepTimeout: 5000, screenUpdateInterval: 5, okInterval: 600, ledColorConnected: [0, 255, 0], ledColorDisconnected: [255, 0, 0], ledColorActive: [0, 255, 0], ledColorButton: [255, 165, 0], ledBrightness: 10 }; for (let m = 0; m < loaded.menuCount; m++)for (let i = 0; i < 12; i++) { let btn = loaded.menus[m].buttons[i]; btn.imageData = null; if (btn.icon && btn.icon.startsWith('/i_')) { let filename = btn.icon.substring(1), imageFile = zip.file(filename); if (imageFile) { let rawData = await imageFile.async('uint8array'), dataUrl = await rgb565ToDataUrl(rawData); btn.imageData = dataUrl } } } cfg = loaded; activeMenu = 0; render(); showStatus('✓ ZIP loaded!') } catch (err) { showStatus('✗ Failed to load ZIP!', 'error') } event.target.value = '' } function rgb565ToDataUrl(rgb565Data) { return new Promise((resolve) => { let canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d'); canvas.width = 67; canvas.height = 67; let imageData = ctx.createImageData(67, 67), pixels = imageData.data; for (let i = 0; i < 67 * 67; i++) { let rgb565 = (rgb565Data[i * 2] << 8) | rgb565Data[i * 2 + 1], r = ((rgb565 >> 11) & 0x1F) << 3, g = ((rgb565 >> 5) & 0x3F) << 2, b = (rgb565 & 0x1F) << 3; r = r | (r >> 5); g = g | (g >> 6); b = b | (b >> 5); pixels[i * 4] = r; pixels[i * 4 + 1] = g; pixels[i * 4 + 2] = b; pixels[i * 4 + 3] = 255 } ctx.putImageData(imageData, 0, 0); resolve(canvas.toDataURL('image/png')) }) } render();
    </script>
</body>

</html>